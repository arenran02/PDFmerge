<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¡œì»¬ PDF íˆ´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- pdf-lib (ì´ë¯¸ì§€ â†’ PDF, PDF ë³‘í•©ìš©) -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f4f5;
      color: #111827;
      display: flex;
      justify-content: center;
      padding: 32px 16px;
    }
    .app {
      width: 100%;
      max-width: 900px;
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.15);
      padding: 24px;
    }
    h1 {
      margin-top: 0;
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    h1 span.logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: #111827;
      color: #f9fafb;
      font-size: 16px;
    }
    .mode-switch {
      display: flex;
      gap: 8px;
      margin: 16px 0 20px;
    }
    .mode-option {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.15s, border-color 0.15s, color 0.15s, transform 0.05s ease-out;
    }
    .mode-option input { display: none; }
    .mode-option.active {
      background: #111827;
      color: #f9fafb;
      border-color: #111827;
      transform: translateY(-1px);
    }
    .mode-option span.icon { font-size: 16px; }
    .hint {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 16px;
    }

    .drop-zone {
      border-radius: 16px;
      border: 1.8px dashed #d1d5db;
      padding: 24px;
      text-align: center;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: border-color 0.15s, background 0.15s, transform 0.05s ease-out;
    }
    .drop-zone.dragover {
      border-color: #111827;
      background: #e5e7eb;
      transform: translateY(-1px);
    }
    .drop-title { font-weight: 600; font-size: 14px; }
    .drop-sub { font-size: 12px; color: #6b7280; }
    .browse-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #111827;
      background: #111827;
      color: #f9fafb;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      gap: 6px;
    }
    .browse-btn span { font-size: 14px; }
    #file-input { display: none; }

    .list-container { margin-top: 20px; }
    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .list-header-left {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* ì •ë ¬ UI */
    .sort-wrap {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 999px;
      padding: 6px 10px;
      color: #374151;
    }
    .sort-label { font-size: 12px; color: #6b7280; }
    .sort-select {
      border: none;
      background: transparent;
      outline: none;
      font-size: 12px;
      color: #111827;
      cursor: pointer;
      padding: 2px 4px;
    }

    .clear-btn {
      border: none;
      background: none;
      color: #9ca3af;
      font-size: 12px;
      cursor: pointer;
    }
    .clear-btn:hover { color: #ef4444; }

    .file-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 260px;
      overflow-y: auto;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }
    .file-item {
      display: flex;
      align-items: center;
      padding: 8px 10px;
      gap: 10px;
      font-size: 13px;
      cursor: grab;
      user-select: none;
    }
    .file-item.dragging { opacity: 0.4; }
    .file-item + .file-item { border-top: 1px solid #e5e7eb; }
    .file-thumb {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      overflow: hidden;
      flex-shrink: 0;
    }
    .file-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .file-meta { flex: 1; min-width: 0; }
    .file-name {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .file-size { font-size: 11px; color: #9ca3af; }
    .drag-handle {
      font-size: 16px;
      color: #9ca3af;
      cursor: grab;
      padding: 0 4px;
    }
    .remove-btn {
      border: none;
      background: none;
      color: #9ca3af;
      font-size: 16px;
      cursor: pointer;
      padding: 0 4px;
    }
    .remove-btn:hover { color: #ef4444; }

    .actions {
      margin-top: 20px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      flex-wrap: wrap;
    }
    .primary-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: #111827;
      color: #f9fafb;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.35);
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out, opacity 0.15s;
    }
    .primary-btn:disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
      transform: none;
    }
    .primary-btn:not(:disabled):active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.25);
    }

    .secondary-btn {
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      cursor: pointer;
      color: #374151;
    }

    @media (max-width: 640px) {
      .app { padding: 18px; }
      h1 { font-size: 20px; }
      .file-item { padding: 8px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>
      <span class="logo">P</span>
      ë¡œì»¬ PDF ë„êµ¬
    </h1>

    <!-- ëª¨ë“œ ì „í™˜ -->
    <div class="mode-switch" id="mode-switch">
      <label class="mode-option active" data-mode="images">
        <input type="radio" name="mode" value="images" checked />
        <span class="icon">ğŸ–¼ï¸</span>
        <span>ì´ë¯¸ì§€ â†’ PDF</span>
      </label>
      <label class="mode-option" data-mode="merge">
        <input type="radio" name="mode" value="merge" />
        <span class="icon">ğŸ“„</span>
        <span>PDF í•©ì¹˜ê¸°</span>
      </label>
    </div>

    <div class="hint" id="mode-hint">
      PNG / JPG ì—¬ëŸ¬ ê°œë¥¼ ì˜¬ë ¤ì„œ í•˜ë‚˜ì˜ PDFë¡œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.
    </div>

    <!-- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ -->
    <div class="drop-zone" id="drop-zone">
      <div class="drop-title" id="drop-title">
        ì—¬ê¸°ì— íŒŒì¼ì„ ë“œë˜ê·¸í•´ì„œ ì˜¬ë ¤ì£¼ì„¸ìš”
      </div>
      <div class="drop-sub" id="drop-sub">
        ë˜ëŠ”
      </div>
      <button class="browse-btn" id="browse-btn" type="button">
        <span>ğŸ“</span> íŒŒì¼ ì„ íƒí•˜ê¸°
      </button>
      <input type="file" id="file-input" multiple />
    </div>

    <!-- íŒŒì¼ ë¦¬ìŠ¤íŠ¸ -->
    <div class="list-container">
      <div class="list-header">
        <div class="list-header-left">
          <span>íŒŒì¼ ëª©ë¡ (ë“œë˜ê·¸í•´ì„œ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥)</span>

          <!-- ì •ë ¬ ì˜µì…˜ -->
          <div class="sort-wrap" title="ì •ë ¬ ì ìš© í›„ ë“œë˜ê·¸í•˜ë©´ ìˆ˜ë™ìœ¼ë¡œ ì „í™˜ë©ë‹ˆë‹¤.">
            <span class="sort-label">ì •ë ¬</span>
            <select class="sort-select" id="sort-select">
              <option value="manual" selected>ìˆ˜ë™(ë“œë˜ê·¸)</option>
              <option value="name-asc">ì´ë¦„ìˆœ (Aâ†’Z)</option>
              <option value="name-desc">ì´ë¦„ìˆœ (Zâ†’A)</option>
              <option value="time-asc">ì‹œê°„ìˆœ (ì˜¤ë˜ëœâ†’ìµœì‹ )</option>
              <option value="time-desc">ì‹œê°„ìˆœ (ìµœì‹ â†’ì˜¤ë˜ëœ)</option>
            </select>
          </div>
        </div>

        <button class="clear-btn" id="clear-btn" type="button">ì „ì²´ ì§€ìš°ê¸°</button>
      </div>

      <ul class="file-list" id="file-list"></ul>
    </div>

    <!-- ì•¡ì…˜ ë²„íŠ¼ -->
    <div class="actions">
      <button class="secondary-btn" id="test-order-btn" type="button" style="display:none;">
        ìˆœì„œ í…ŒìŠ¤íŠ¸
      </button>
      <button class="primary-btn" id="convert-btn" type="button" disabled>
        <span id="convert-label">PDF ë§Œë“¤ê¸°</span>
      </button>
    </div>
  </div>

  <script>
    const dropZone = document.getElementById("drop-zone");
    const fileInput = document.getElementById("file-input");
    const fileListEl = document.getElementById("file-list");
    const clearBtn = document.getElementById("clear-btn");
    const convertBtn = document.getElementById("convert-btn");
    const convertLabel = document.getElementById("convert-label");
    const modeSwitch = document.getElementById("mode-switch");
    const modeHint = document.getElementById("mode-hint");
    const browseBtn = document.getElementById("browse-btn");
    const dropTitle = document.getElementById("drop-title");
    const dropSub = document.getElementById("drop-sub");

    // ì •ë ¬
    const sortSelect = document.getElementById("sort-select");
    let sortOption = "manual";

    let mode = "images"; // "images" or "merge"
    let fileItems = [];
    let dragSrcIndex = null;

    function setSortOption(next) {
      sortOption = next;
      sortSelect.value = next;
    }

    function applySort(option) {
      if (option === "manual") return;

      if (option === "name-asc") {
        fileItems.sort((a, b) =>
          a.file.name.localeCompare(b.file.name, "ko", { numeric: true, sensitivity: "base" })
        );
      } else if (option === "name-desc") {
        fileItems.sort((a, b) =>
          b.file.name.localeCompare(a.file.name, "ko", { numeric: true, sensitivity: "base" })
        );
      } else if (option === "time-asc") {
        fileItems.sort((a, b) => a.addedAt - b.addedAt);
      } else if (option === "time-desc") {
        fileItems.sort((a, b) => b.addedAt - a.addedAt);
      }
    }

    sortSelect.addEventListener("change", (e) => {
      const val = e.target.value;
      setSortOption(val);
      applySort(val);
      renderFileList();
    });

    function updateModeUI() {
      const options = modeSwitch.querySelectorAll(".mode-option");
      options.forEach((opt) => {
        if (opt.dataset.mode === mode) opt.classList.add("active");
        else opt.classList.remove("active");
      });

      if (mode === "images") {
        modeHint.textContent = "PNG / JPG ì—¬ëŸ¬ ê°œë¥¼ ì˜¬ë ¤ì„œ í•˜ë‚˜ì˜ PDFë¡œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.";
        convertLabel.textContent = "PDF ë§Œë“¤ê¸°";
        dropTitle.textContent = "ì´ë¯¸ì§€ íŒŒì¼ì„ ë“œë˜ê·¸í•´ì„œ ì˜¬ë ¤ì£¼ì„¸ìš”";
        dropSub.textContent = "ë˜ëŠ”";
        fileInput.accept = "image/png,image/jpeg";
      } else {
        modeHint.textContent = "ì—¬ëŸ¬ ê°œì˜ PDF íŒŒì¼ì„ ì˜¬ë ¤ì„œ í•˜ë‚˜ì˜ PDFë¡œ í•©ì¹  ìˆ˜ ìˆì–´ìš”.";
        convertLabel.textContent = "PDF í•©ì¹˜ê¸°";
        dropTitle.textContent = "PDF íŒŒì¼ì„ ë“œë˜ê·¸í•´ì„œ ì˜¬ë ¤ì£¼ì„¸ìš”";
        dropSub.textContent = "ë˜ëŠ”";
        fileInput.accept = "application/pdf";
      }

      fileItems = [];
      setSortOption("manual");
      renderFileList();
    }

    modeSwitch.addEventListener("click", (e) => {
      const label = e.target.closest(".mode-option");
      if (!label) return;
      const newMode = label.dataset.mode;
      if (newMode && newMode !== mode) {
        mode = newMode;
        updateModeUI();
      }
    });

    browseBtn.addEventListener("click", () => fileInput.click());

    fileInput.addEventListener("change", (e) => {
      if (!e.target.files) return;
      handleFiles(e.target.files);
      fileInput.value = "";
    });

    ["dragenter", "dragover"].forEach((eventName) => {
      dropZone.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.classList.add("dragover");
      });
    });

    ["dragleave", "drop"].forEach((eventName) => {
      dropZone.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (eventName === "drop") {
          dropZone.classList.remove("dragover");
        } else if (!dropZone.contains(e.relatedTarget)) {
          dropZone.classList.remove("dragover");
        }
      });
    });

    dropZone.addEventListener("drop", (e) => {
      const dt = e.dataTransfer;
      if (!dt || !dt.files) return;
      handleFiles(dt.files);
    });

    function handleFiles(fileList) {
      const arr = Array.from(fileList);
      const filtered = arr.filter((file) => {
        if (mode === "images") {
          return file.type === "image/png" || file.type === "image/jpeg";
        } else {
          return file.type === "application/pdf";
        }
      });

      const rejectedCount = arr.length - filtered.length;
      if (rejectedCount > 0) {
        alert(
          mode === "images"
            ? "PNG/JPG í˜•ì‹ì˜ ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            : "PDF íŒŒì¼ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        );
      }

      const now = Date.now();
      filtered.forEach((file, idx) => {
        fileItems.push({
          id: now.toString() + "-" + idx.toString() + "-" + Math.random().toString(16).slice(2),
          file,
          addedAt: now + idx,
        });
      });

      renderFileList();
    }

    function renderFileList() {
      fileListEl.innerHTML = "";
      if (fileItems.length === 0) {
        convertBtn.disabled = true;
        return;
      }
      convertBtn.disabled = false;

      fileItems.forEach((item, index) => {
        const li = document.createElement("li");
        li.className = "file-item";
        li.draggable = true;
        li.dataset.index = index;

        const handle = document.createElement("span");
        handle.className = "drag-handle";
        handle.textContent = "â‹®â‹®";

        const thumb = document.createElement("div");
        thumb.className = "file-thumb";

        if (mode === "images") {
          const img = document.createElement("img");
          const reader = new FileReader();
          reader.onload = (e) => { img.src = e.target.result; };
          reader.readAsDataURL(item.file);
          thumb.appendChild(img);
        } else {
          thumb.textContent = "ğŸ“„";
        }

        const meta = document.createElement("div");
        meta.className = "file-meta";

        const name = document.createElement("div");
        name.className = "file-name";
        name.textContent = item.file.name;

        const size = document.createElement("div");
        size.className = "file-size";
        size.textContent = formatBytes(item.file.size);

        meta.appendChild(name);
        meta.appendChild(size);

        const removeBtn = document.createElement("button");
        removeBtn.className = "remove-btn";
        removeBtn.type = "button";
        removeBtn.textContent = "âœ•";
        removeBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          fileItems.splice(index, 1);
          renderFileList();
        });

        li.appendChild(handle);
        li.appendChild(thumb);
        li.appendChild(meta);
        li.appendChild(removeBtn);

        li.addEventListener("dragstart", (e) => {
          if (sortOption !== "manual") setSortOption("manual");
          dragSrcIndex = Number(li.dataset.index);
          li.classList.add("dragging");
          e.dataTransfer.effectAllowed = "move";
        });

        li.addEventListener("dragend", () => {
          li.classList.remove("dragging");
        });

        li.addEventListener("dragover", (e) => {
          e.preventDefault();
          const targetIndex = Number(li.dataset.index);
          if (targetIndex === dragSrcIndex || dragSrcIndex === null) return;
          moveItem(dragSrcIndex, targetIndex);
          dragSrcIndex = targetIndex;
          renderFileList();
        });

        fileListEl.appendChild(li);
      });
    }

    function moveItem(fromIndex, toIndex) {
      if (
        fromIndex < 0 ||
        toIndex < 0 ||
        fromIndex >= fileItems.length ||
        toIndex >= fileItems.length
      ) return;
      const [moved] = fileItems.splice(fromIndex, 1);
      fileItems.splice(toIndex, 0, moved);
    }

    clearBtn.addEventListener("click", () => {
      if (fileItems.length === 0) return;
      if (confirm("ëª¨ë“  íŒŒì¼ì„ ëª©ë¡ì—ì„œ ì œê±°í• ê¹Œìš”?")) {
        fileItems = [];
        setSortOption("manual");
        renderFileList();
      }
    });

    function formatBytes(bytes) {
      if (bytes === 0) return "0 B";
      const k = 1024;
      const sizes = ["B", "KB", "MB", "GB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return (bytes / Math.pow(k, i)).toFixed(1) + " " + sizes[i];
    }

    convertBtn.addEventListener("click", async () => {
      if (fileItems.length === 0) {
        alert("ë¨¼ì € íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
        return;
      }

      convertBtn.disabled = true;
      const originalLabel = convertLabel.textContent;
      convertLabel.textContent = "ì²˜ë¦¬ ì¤‘...";

      try {
        if (mode === "images") {
          await createPdfFromImages();
        } else {
          await mergePdfs();
        }
      } catch (err) {
        console.error(err);
        alert("PDF ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.");
      } finally {
        convertBtn.disabled = false;
        convertLabel.textContent = originalLabel;
      }
    });

    // âœ… EXIF íšŒì „ ë°©ì§€: íŒŒì¼ â†’ (ì˜¬ë°”ë¥¸ ë°©í–¥ìœ¼ë¡œ ë””ì½”ë”©) â†’ ìº”ë²„ìŠ¤ ì¬ì¸ì½”ë”©(ë©”íƒ€ ì œê±°) â†’ PDFì— ì‚½ì…
    async function normalizeImageForPdf(file) {
      // 1) EXIF ë°©í–¥ ë°˜ì˜í•´ì„œ ë¹„íŠ¸ë§µ ìƒì„± (ì§€ì› ì•ˆë˜ë©´ ê·¸ëƒ¥ ìƒì„±)
      let bitmap;
      try {
        bitmap = await createImageBitmap(file, { imageOrientation: "from-image" });
      } catch (e) {
        bitmap = await createImageBitmap(file);
      }

      // 2) ìº”ë²„ìŠ¤ì— ë‹¤ì‹œ ê·¸ë ¤ì„œ ë©”íƒ€ë°ì´í„°(Orientation) ì œê±°
      const canvas = document.createElement("canvas");
      canvas.width = bitmap.width;
      canvas.height = bitmap.height;
      const ctx = canvas.getContext("2d", { alpha: false });
      ctx.drawImage(bitmap, 0, 0);

      // 3) ë‹¤ì‹œ Blobìœ¼ë¡œ (JPEGëŠ” jpegë¡œ, PNGëŠ” pngë¡œ)
      const outMime = (file.type === "image/png") ? "image/png" : "image/jpeg";
      const blob = await new Promise((resolve) => {
        if (outMime === "image/jpeg") {
          canvas.toBlob(resolve, outMime, 0.92);
        } else {
          canvas.toBlob(resolve, outMime);
        }
      });

      // cleanup
      if (bitmap && bitmap.close) bitmap.close();

      if (!blob) {
        // ê·¹ë‹¨ì  ì˜ˆì™¸: toBlob ì‹¤íŒ¨ ì‹œ ì›ë³¸ ì‚¬ìš©
        return { arrayBuffer: await file.arrayBuffer(), mime: file.type };
      }

      return { arrayBuffer: await blob.arrayBuffer(), mime: outMime };
    }

    async function createPdfFromImages() {
      const { PDFDocument } = PDFLib;
      const pdfDoc = await PDFDocument.create();

      for (const item of fileItems) {
        const file = item.file;

        // âœ… íšŒì „ ë°©ì§€ ì ìš©ëœ ì´ë¯¸ì§€ ë°”ì´íŠ¸
        const normalized = await normalizeImageForPdf(file);

        let image;
        if (normalized.mime === "image/png") {
          image = await pdfDoc.embedPng(normalized.arrayBuffer);
        } else {
          image = await pdfDoc.embedJpg(normalized.arrayBuffer);
        }

        const imgDims = image.scale(1);

        // ê¸°ë³¸ í˜ì´ì§€(ê¸°ë³¸ê°’) ìœ„ì— ì´ë¯¸ì§€ ë§ì¶° ë„£ê¸°
        const page = pdfDoc.addPage();
        const pageWidth = page.getWidth();
        const pageHeight = page.getHeight();

        const scale = Math.min(
          pageWidth / imgDims.width,
          pageHeight / imgDims.height
        );

        const imgWidth = imgDims.width * scale;
        const imgHeight = imgDims.height * scale;

        page.drawImage(image, {
          x: (pageWidth - imgWidth) / 2,
          y: (pageHeight - imgHeight) / 2,
          width: imgWidth,
          height: imgHeight,
        });
      }

      const pdfBytes = await pdfDoc.save();
      downloadPdf(pdfBytes, "images-to-pdf.pdf");
    }

    async function mergePdfs() {
      const { PDFDocument } = PDFLib;
      const mergedPdf = await PDFDocument.create();

      for (const item of fileItems) {
        const bytes = await item.file.arrayBuffer();
        const pdf = await PDFDocument.load(bytes);
        const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
        copiedPages.forEach((p) => mergedPdf.addPage(p));
      }

      const pdfBytes = await mergedPdf.save();
      downloadPdf(pdfBytes, "merged.pdf");
    }

    function downloadPdf(pdfBytes, filename) {
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

    updateModeUI();
  </script>
</body>
</html>
